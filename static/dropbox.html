<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Upload e Gerenciamento de Arquivos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title text-center">Upload de Arquivos</h2>
                <form id="uploadForm" class="mt-4">
                    <div class="mb-3">
                        <label for="folderName" class="form-label">Nome do Diretório (Opcional)</label>
                        <input type="text" class="form-control" id="folderName" name="folder_name" placeholder="Digite o nome do diretório">
                    </div>
                    <div class="mb-3">
                        <label for="files" class="form-label">Selecione os Arquivos</label>
                        <input type="file" class="form-control" id="files" name="files" multiple required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Enviar Arquivos</button>
                </form>
                <div id="response" class="mt-3"></div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title text-center">Criar Nova Pasta</h2>
                <form id="createFolderForm" class="mt-4">
                    <div class="mb-3">
                        <label for="newFolderName" class="form-label">Nome da Nova Pasta</label>
                        <input type="text" class="form-control" id="newFolderName" name="folder_name" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Criar Pasta</button>
                </form>
                <div id="folderResponse" class="mt-3"></div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title text-center">Listar Arquivos</h2>
                <form id="listFilesForm" class="mt-4">
                    <div class="mb-3">
                        <label for="listFolderName" class="form-label">Nome da Pasta</label>
                        <input type="text" class="form-control" id="listFolderName" name="folder_name" required>
                    </div>
                    <button type="submit" class="btn btn-info w-100">Listar Arquivos</button>
                </form>
                <div id="listFilesResponse" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById("uploadForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            const formData = new FormData();
            const files = document.getElementById("files").files;
            const folderName = document.getElementById("folderName").value;

            if (files.length === 0) {
                alert("Selecione pelo menos um arquivo para upload.");
                return;
            }

            for (let i = 0; i < files.length; i++) {
                formData.append("files", files[i]);
            }

            if (folderName) {
                formData.append("folder_name", folderName);
            }

            const responseDiv = document.getElementById("response");
            responseDiv.innerHTML = "<p class='text-info'>Enviando arquivos...</p>";

            try {
                const response = await fetch("https://gmf-api-zay6.onrender.com/upload/", {
                    method: "POST",
                    body: formData
                });

                if (!response.ok) {
                    alert(response.status);
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.json();
                responseDiv.innerHTML = "<p class='text-success'>Arquivos enviados com sucesso!</p>";
                Object.entries(result.files).forEach(([name, url]) => {
                    responseDiv.innerHTML += `<p><a href="${url}" target="_blank">${name}</a></p>`;
                });

            } catch (error) {
                responseDiv.innerHTML = `<p class='text-danger'>Erro ao enviar os arquivos: ${error.message}</p>`;
            }
        });

        document.getElementById("createFolderForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            const folderName = document.getElementById("newFolderName").value;
            const responseDiv = document.getElementById("folderResponse");

            try {
                const response = await fetch("https://gmf-api-zay6.onrender.com/create-folder/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `folder_name=${folderName}`
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.json();
                responseDiv.innerHTML = `<p class='text-success'>Pasta criada: ${result.folder}</p>`;
            } catch (error) {
                responseDiv.innerHTML = `<p class='text-danger'>Erro ao criar pasta: ${error.message}</p>`;
            }
        });

        document.getElementById("listFilesForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            const folderName = document.getElementById("listFolderName").value;
            const responseDiv = document.getElementById("listFilesResponse");

            try {
                const response = await fetch(`https://gmf-api-zay6.onrender.com/list-files/?folder_hash=${folderName}`, {
                    method: "GET"
                });

                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }

                const result = await response.json();
                responseDiv.innerHTML = "<p class='text-success'>Arquivos encontrados:</p>";
                Object.entries(result.files).forEach(([name, url]) => {
                    responseDiv.innerHTML += `<p><a href="${url}" target="_blank">${name}</a></p>`;
                });

            } catch (error) {
                responseDiv.innerHTML = `<p class='text-danger'>Erro ao listar arquivos: ${error.message}</p>`;
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
